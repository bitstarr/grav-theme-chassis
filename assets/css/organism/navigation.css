/* see: https://web.dev/building-a-sidenav-component/ */

/*
    make a nice mouse and keyboard nav
    see https://css-tricks.com/solved-with-css-dropdown-menus/
    design inspiration: https://dev.to/5t3ph/css-only-accessible-dropdown-navigation-menu-1f95
*/
/*  for touch use a bit js to toggle an 'open' class - like the
    nav twig macro provides in case of current page is in submenu.
    this way we can depciate the checkbox hack for this usage and
    provide a better a11y experience.
    @see https://inclusive-components.design/menus-menu-buttons/
    @see https://bitsofco.de/accessible-multi-level-dropdown-navigation/
*/

.menu {
    &__item {
        &:hover,
        &:focus-within {
            cursor: pointer;
        }

    }
    &__item:hover > &__link,
    &__link:focus {
        --link-color: var( --color-secondary );
    }
}

@media (min-width: 40em) {
    .navigation {
        &__open,
        &__close {
            display: none;
        }
    }
    .menu {
        margin: 0;
        padding: 0;
        list-style: none;
        display: flex;

        &__item {
            position: relative;
            padding: .4em;
        }

        &__item:hover > .submenu,
        &__item:focus-within > .submenu,
        &__item .submenu:hover,
        &__item .submenu:focus {
            visibility: visible;
            opacity: 1;
            display: block;
            transform: rotateX(0);
            /* transition: 280ms all 120ms ease-out; */
            transition:
            transform var(--duration) ease-out,
            opacity var(--duration) ease-out;
        }

        &--minor {
            display: none;
        }
    }
    /* TODO: Style! */
    .submenu {
        position: absolute;
        z-index: 101;
        left: 0;
        /* display: none; */
        visibility: hidden;
        min-width: 5rem;
        /* margin-top: 1rem; */
        background: #f3f3f3;
        opacity: 0;
        /* transition: all .5s ease; */

        min-width: 15ch;
        /* left: 50%; */
        top: calc(100% - .25rem);
        transform: rotateX(-90deg);
        transform-origin: top center;
        opacity: .3;
        padding: .5em 0;
        border-radius: 4px;
        box-shadow: 0 .15em .25em #00000040;
        --duration: .3s;
        transition:
            transform var(--duration) ease-out,
            opacity var(--duration) ease-out,
            visibility 0s linear var(--duration);

        &::after {
            content: '';
            position: absolute;
            z-index: 102;
            top: -.75em;
            left: 10%;
            border: .5rem solid transparent;
            border-bottom-color: transparent;
            border-bottom-color: #f3f3f3;
            transform: translateX(-50%);
            transition: 280ms all 120ms ease-out;
            will-change: opacity;
        }
    }
}

@media (max-width: 39.99em) {
    .navigation {
        --easeOutExpo: cubic-bezier( .16, 1, .3, 1 );
        --duration: .6s;
        position: fixed;
        z-index: 10;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        display: grid;
        grid-template-columns: [nav] 3fr [escape] 1fr;

        visibility: hidden;
        transform: translateX(-110vw);
        will-change: transform;
        transition:
            transform var(--duration) var(--easeOutExpo),
            visibility 0s linear var(--duration);

        &:target {
            visibility: visible;
            transform: translateX(0);
            transition: transform var(--duration) var(--easeOutExpo);
        }

        &__layer {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            overflow-y: auto;
            padding: 1.5em;
            color: var( --overlay-txt );
            background-color: var( --overlay-bg );
        }

        &__open {
            padding: 1ex var( --space, 1rem );
            line-height: 1;

            &:focus,
            &:hover {
                color: var( --color-secondary );
            }
        }

        &__close {
            background: linear-gradient( to left, transparent, hsl( 0 0% 0% / .3 ) );
        }
    }
    .menu {
        margin: 0;
        padding: 0;
        list-style: none;

        &__item {
            position: relative;
            display: block;
            padding: .6em;
            white-space: nowrap;
        }

        & > &__item > &__link {
            font-weight: 700;
        }

        .active  &__link {
            text-decoration: underline;
        }
    }
    .submenu {
        padding-top: .6em;

        & + & {
            display: none;
        }
    }
}


@media (prefers-reduced-motion: reduce) {
    .navigation {
        --duration: 1ms;
    }
}